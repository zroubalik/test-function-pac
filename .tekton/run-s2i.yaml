apiVersion: tekton.dev/v1beta1
kind: PipelineRun
metadata:
  labels:
    boson.dev/function: "true"
    boson.dev/runtime: node
    function.knative.dev: "true"
    function.knative.dev/name: viewer
    function.knative.dev/runtime: node
    tekton.dev/pipeline: viewer-s2i-git-pipeline
  annotations:
    # The event we are targeting as seen from the webhook payload
    # this can be an array too, i.e: [pull_request, push]
    #pipelinesascode.tekton.dev/on-event: "[push]"

    # The branch or tag we are targeting (ie: main, refs/tags/*)
    pipelinesascode.tekton.dev/on-target-branch: "[main]"

    # Fetch the git-clone task from hub, we are able to reference later on it
    # with taskRef and it will automatically be embedded into our pipeline.
    #pipelinesascode.tekton.dev/task: "git-clone:0.4"
    pipelinesascode.tekton.dev/task: "git-clone"

    pipelinesascode.tekton.dev/task-1: "https://raw.githubusercontent.com/knative/func/main/pipelines/resources/tekton/task/func-s2i/0.1/func-s2i.yaml"
    pipelinesascode.tekton.dev/task-2: "https://raw.githubusercontent.com/knative/func/main/pipelines/resources/tekton/task/func-deploy/0.1/func-deploy.yaml"


    # You can add more tasks by increasing the suffix number, you can specify them as array to have multiple of them.
    # browse the tasks you want to include from hub on https://hub.tekton.dev/
    #
    # pipelinesascode.tekton.dev/task-2: "[curl, buildah]"

    # How many runs we want to keep attached to this event
    pipelinesascode.tekton.dev/max-keep-runs: "5"
  name: viewer-s2i-git-pipeline-run-xxxx-1
spec:
  params:
  - name: gitRepository
    value: https://github.com/lance/viewer
  - name: gitRevision
    value: ""
  - name: contextDir
    value: .
  - name: imageName
    value: quay.io/lanceball/viewer:latest
  - name: builderImage
    value: registry.access.redhat.com/ubi8/nodejs-16
  - name: buildEnvs
    value:
    - =
  pipelineRef:
    name: viewer-s2i-git-pipeline
  serviceAccountName: default
  timeout: 1h0m0s
  workspaces:
  - name: source-workspace
    persistentVolumeClaim:
      claimName: viewer-s2i-git-pipeline-pvc
    subPath: source
  - name: dockerconfig-workspace
    secret:
      secretName: viewer-s2i-git-pipeline-secret
